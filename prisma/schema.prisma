generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum SubjectType {
  COMPULSORY
  ELECTIVE
}

enum TestType {
  MONTHLY
  SESSION
}

model Class {
  id         Int     @id @default(autoincrement())
  externalId String  @unique @default(uuid())
  name       String
  isActive   Boolean @default(true)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  createdBy String?
  updatedBy String?

  students       Student[]
  subjectClasses SubjectClass[]
  tests          Test[]
}

model Student {
  id         Int     @id @default(autoincrement())
  externalId String  @unique @default(uuid())
  firstName  String
  lastName   String
  fatherName String
  email      String?
  contactNo  String?
  rollNumber String
  classId    Int
  isActive   Boolean @default(true)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  createdBy String?
  updatedBy String?

  class           Class            @relation(fields: [classId], references: [id])
  scores          StudentScore[]
  studentSubjects StudentSubject[]

  @@unique([classId, rollNumber])
}

model Subject {
  id          Int         @id @default(autoincrement())
  externalId  String      @unique @default(uuid())
  name        String
  isActive    Boolean     @default(true)
  subjectType SubjectType
  maxMarks    Int

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  createdBy String?
  updatedBy String?

  subjectClasses SubjectClass[]
}

model SubjectClass {
  id         Int    @id @default(autoincrement())
  externalId String @unique @default(uuid())

  subjectId Int
  classId   Int

  subject Subject @relation(fields: [subjectId], references: [id])
  class   Class   @relation(fields: [classId], references: [id])

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  createdBy String?
  updatedBy String?

  studentSubjects StudentSubject[]
  scores          StudentScore[]
}

model StudentSubject {
  id         Int    @id @default(autoincrement())
  externalId String @unique @default(uuid())

  studentId      Int
  subjectClassId Int

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  createdBy String?
  updatedBy String?

  student      Student      @relation(fields: [studentId], references: [id])
  subjectClass SubjectClass @relation(fields: [subjectClassId], references: [id])
}

model Test {
  id         Int      @id @default(autoincrement())
  externalId String   @unique @default(uuid())
  name       String
  testType   TestType
  totalMarks Int
  classId    Int
  isActive   Boolean  @default(true)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  createdBy String?
  updatedBy String?

  class  Class          @relation(fields: [classId], references: [id])
  scores StudentScore[]
}

model StudentScore {
  id         Int    @id @default(autoincrement())
  externalId String @unique @default(uuid())

  studentId      Int
  testId         Int
  subjectClassId Int

  marksObtained Int

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  createdBy String?
  updatedBy String?

  student      Student      @relation(fields: [studentId], references: [id])
  test         Test         @relation(fields: [testId], references: [id])
  subjectClass SubjectClass @relation(fields: [subjectClassId], references: [id])
}

model GradeScale {
  id            Int    @id @default(autoincrement())
  externalId    String @unique @default(uuid())
  minPercentage Float
  maxPercentage Float
  grade         String
  remarks       String

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  createdBy String?
  updatedBy String?
}
